{% extends 'layout.html' %}

{% block menu %}
<ul class="navbar-nav mr-auto">
    <li class="nav-item active">
        <a class="nav-link" href="/escuelas"> Escuelas <span class="sr-only">(current)</span></a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="/graduaciones"> Graduaciones </a>
    </li>
</ul>
{% endblock %}

{% block body %}

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert {{category}} alert-dismissible fade show mt-3 col-12" role="alert">
    {{message}}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
{% endfor %}
{% endif %}
{% endwith %}

<h2 class="text-center mt-4">{{event}}</h2>

<!-- options -->
<div class="row justify-content-center form-inline">

    <div class="col-7 col-lg-5 my-1">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text">Buscar</div>
            </div>
            <input type="text" autocomplete="off" class="form-control" id="search" placeholder="Nombre del cliente">
        </div>
    </div>

    <button type="button" class="col-3 col-lg-1 btn btn-info btn-md m-4" data-toggle="modal"
        data-target="#exampleModalScrollable" onclick="add_client_grd('{{ event }}')">
        Agregar
    </button>

</div>

<!-- create table -->
<div class="row mt-4 justify-content-center">
    <table class="table table-striped table-active table-bordered table-sm text-center col-11">
        <thead>
            <tr>
                <td class="medium-display">Nombre</td>
                <td class="no_visible"># de Mesa</td>
                <td class="no_visible"># de Foto</td>
                <td class="no_visible">6x9</td>
                <td class="no_visible">8x12</td>
                <td class="no_visible">Costo</td>
                <td class="no_visible">Pagado</td>
                <td class="medium-display">Acciones</td>
            </tr>
        </thead>
        <tbody id="table">

            {% for client in data %}
            <tr>
                <td>{{ client.1 }}</td>
                <td class="no_visible">{{ client.2 }}</td>
                <td class="no_visible">{{ client.3 }}</td>
                <td class="no_visible">{{ client.4 }}</td>
                <td class="no_visible">{{ client.5 }}</td>
                <td class="no_visible">{{ client.6 }}</td>
                <td class="no_visible">{{ client.7 }}</td>
                <td>
                    <button type="button" class="btn btn-info btn-sm" data-toggle="modal"
                        data-target="#exampleModalScrollable"
                        onclick="edit_client_grd('{{ client.0 }}','{{ client.1 }}','{{ client.2 }}','{{ client.3 }}','{{ client.4 }}','{{ client.5 }}','{{ client.6 }}','{{ client.7 }}','{{ event }}')">
                        Editar
                    </button>

                    <button type="button" class="btn btn-danger btn-sm ml-1" data-toggle="modal"
                        data-target="#exampleModalScrollable"
                        onclick="delete_client_grd('{{ client.0 }}','{{ client.1 }}','{{ client.2 }}','{{ client.3 }}','{{ client.4 }}','{{ client.5 }}','{{ client.6 }}','{{ client.7 }}','{{ event }}')">
                        Eliminar
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- modal add/edit/delete -->
<div class="modal fade" id="exampleModalScrollable" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="title_window"></h5>
                <button type="button" class="close" onclick="reset_cost();" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#data">Datos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#cost">Costo</a>
                    </li>
                </ul>

                <div id="myTabContent" class="tab-content">

                    <!-- tab for actions -->
                    <div class="tab-pane fade active show" id="data">
                        <form action="" method="POST" id="form_update">

                            <div class="form-group">
                                <label for="exampleInputEmail1">Nombre</label>
                                <input type="text" class="form-control" autocomplete="off"
                                    placeholder="Nombre del cliente" name="name" id="id_name">
                            </div>

                            <div class="row">
                                <div class="form-group col">
                                    <label for="exampleInputEmail1">Numero de Mesa</label>
                                    <input type="number" class="form-control" autocomplete="off"
                                        placeholder="Numero de mesa" name="id_table" id="id_mesa">
                                </div>
                                <div class="form-group col">
                                    <label for="exampleInputEmail1">Codigo de fotografia</label>
                                    <input type="text" class="form-control" autocomplete="off"
                                        placeholder="Numero de fotografia" name="num_photo" id="id_foto">
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col">
                                    <label for="exampleInputEmail1">6x9</label>
                                    <input type="number" class="form-control" placeholder="Cantidad de fotos"
                                        name="num_6x9" id="id_6x9">
                                </div>
                                <div class="form-group col">
                                    <label for="exampleInputEmail1">8x12</label>
                                    <input type="number" class="form-control" placeholder="Cantidad fotos"
                                        name="num_8x12" id="id_8x12">
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col">
                                    <label for="exampleInputEmail1">Costo total</label>
                                    <input type="number" class="form-control" placeholder="Numero de fotografia"
                                        name="cost" id="id_cost">
                                </div>
                                <div class="form-group col">
                                    <label for="exampleInputEmail1">Pago realizado</label>
                                    <input type="number" class="form-control" autocomplete="off"
                                        placeholder="Numero de fotografia" name="payment" id="id_payment">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                    onclick="reset_cost();">Cancelar</button>
                                <button type="submit" id="btn_form" class="btn btn-primary"> Actualizar </button>
                            </div>
                        </form>
                    </div>

                    <!-- tab calculate cost -->
                    <div class="tab-pane fade" id="cost">

                        <div class="row mt-3">
                            <div class="form-group col">
                                <label for="exampleInputEmail1">6x9</label>
                                <input type="number" class="form-control" placeholder="Cantidad de fotos" id="_6x9"
                                    value="0" onchange="calculate_cost();">
                            </div>
                            <div class="form-group col">
                                <label for="exampleInputEmail1">8x12</label>
                                <input type="number" class="form-control" placeholder="Cantidad fotos" id="_8x12"
                                    value="0" onchange="calculate_cost();">
                            </div>
                        </div>

                        <div class="col mt-2">
                            <h5 class="text-center" id="cost_ind">El costo total es de: $ 0</h5>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascript %}

<!-- scripts -->
<script src="{{url_for('static', filename='js/main.js')}}"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
    var event = '{{ event }}';
    var table_initial = document.getElementById('table_initial');
    var new_table = document.getElementById('new_table');

    $(document).ready(function () {
        $("#search").keyup(function () {
            $("#table").html('');
            var search = document.getElementById('search').value;
            $.ajax({
                method: "GET",
                url: "/search_client/" + event,
                data: { text: document.getElementById('search').value },
                success: function (clients) {
                    var output;
                    clients.forEach(client => {
                        output += "<tr>";
                        output += "<td>" + client[1] + "</td>";
                        output += "<td class='no_visible'>" + client[2] + "</td>";
                        output += "<td class='no_visible'>" + client[3] + "</td>";
                        output += "<td class='no_visible'>" + client[4] + "</td>";
                        output += "<td class='no_visible'>" + client[5] + "</td>";
                        output += "<td class='no_visible'>" + client[6] + "</td>";
                        output += "<td class='no_visible'>" + client[7] + "</td>";
                        output += "<td>";
                        output += `<button type='button' class='btn btn-info btn-sm' data-toggle='modal' data-target='#exampleModalScrollable' onclick='edit_client_grd("${client[0]}","${client[1]}","${client[2]}","${client[3]}","${client[4]}","${client[5]}","${client[6]}","${client[7]}","${event}")'>Editar</button>`;
                        output += `<button type='button' class='btn btn-danger btn-sm ml-1' data-toggle='modal' data-target='#exampleModalScrollable' onclick='delete_client_grd("${client[0]}","${client[1]}","${client[2]}","${client[3]}","${client[4]}","${client[5]}","${client[6]}","${client[7]}","${event}")'>Eliminar</button>`;
                        output += "</td>";
                        output += "</tr>";
                    });
                    $('#table').html(output);
                }
            });
        });
    });

</script>

{% endblock %}